


ä»£ç†
export http_proxy=http://192.168.1.8:7890
export https_proxy=http://192.168.1.8:7890

åˆå§‹åŒ–é¡¹ï¼Œç”Ÿæˆpyproject.toml
uv init

æ·»åŠ ä¾èµ–
uv add django



å»ºç«‹ä»“åº“
git remote add origin https://github.com/pierre-netizan/django-mysite.git
git branch -M main
git push -u origin main


podmanéƒ¨ç½²æ•°æ®åº“
# åˆ›å»ºæ‰€éœ€ç›®å½•
mkdir -p ./data/postgres ./data/redis

# ï¼ˆå¯é€‰ï¼‰åˆ›å»ºé…ç½®ç›®å½•å’Œæ–‡ä»¶
# mkdir -p ./config
# echo "appendonly yes" > ./config/redis.conf

# å¯åŠ¨æœåŠ¡
podman-compose up -d

é™„å½•ï¼špodman-compose.yml
```yaml
version: '3.8'

services:
  postgres:
    image: docker.io/library/postgres:16-alpine
    container_name: postgres
    restart: unless-stopped
    environment:
      POSTGRES_DB: app
      POSTGRES_USER: admin
      POSTGRES_PASSWORD: admin
    ports:
      - "54321:5432"
    volumes:
      # å°†å®¿ä¸»æœº ./data/postgres æ˜ å°„ä¸ºå®¹å™¨å†…çš„æ•°æ®ç›®å½•
      - ./data/postgres:/var/lib/postgresql/data
      # å¯é€‰ï¼šåˆå§‹åŒ– SQL è„šæœ¬
      # - ./init.sql:/docker-entrypoint-initdb.d/init.sql

  redis:
    image: docker.io/library/redis:7-alpine
    container_name: redis
    restart: unless-stopped
    ports:
      - "6379:6379"
    volumes:
      # æ•°æ®æŒä¹…åŒ–
      - ./data/redis:/data
      # å¯é€‰ï¼šæŒ‚è½½è‡ªå®šä¹‰é…ç½®æ–‡ä»¶
      # - ./config/redis.conf:/usr/local/etc/redis/redis.conf
      # - ./init-data.sh:/docker-entrypoint-initdb.d/init-data.sh
    command: ["redis-server", "--appendonly", "yes"]
    # å¦‚æœä½¿ç”¨è‡ªå®šä¹‰é…ç½®ï¼Œåˆ™æ”¹ä¸ºï¼š
    # command: ["redis-server", "/usr/local/etc/redis/redis.conf"]
```    




```
uv add django
error: No `pyproject.toml` found in current directory or any parent directory
è¿™ä¸ªé”™è¯¯è¡¨æ˜ä½ æ­£åœ¨å°è¯•ä½¿ç”¨ uv è¿™ä¸ªå·¥å…·æ¥å®‰è£… Djangoï¼Œä½† uv æ‰¾ä¸åˆ° pyproject.toml æ–‡ä»¶ã€‚

uv æ˜¯ä¸€ä¸ªå¿«é€Ÿçš„ Python åŒ…å®‰è£…å’Œè§£æå·¥å…·ï¼Œå®ƒé»˜è®¤åœ¨é¡¹ç›®æ¨¡å¼ï¼ˆproject modeï¼‰ä¸‹è¿è¡Œï¼Œè¿™æ„å‘³ç€å®ƒæœŸæœ›ä½ åœ¨ç®¡ç†ä¸€ä¸ª Python é¡¹ç›®ï¼Œå¹¶ä¸”è¯¥é¡¹ç›®çš„æ ¹ç›®å½•ä¸‹åº”è¯¥æœ‰ä¸€ä¸ª pyproject.tomlï¼ˆæˆ– requirements.txtã€setup.py ç­‰ï¼‰æ–‡ä»¶æ¥å®šä¹‰ä¾èµ–å…³ç³»ã€‚

è§£å†³æ–¹æ¡ˆ
ä½ å¯ä»¥æ ¹æ®ä½ çš„å®é™…éœ€æ±‚é€‰æ‹©ä»¥ä¸‹ä¸€ç§æ–¹æ³•ï¼š

æ–¹æ³•ä¸€ï¼šåˆå§‹åŒ–ä¸€ä¸ªæ–°çš„ Python é¡¹ç›®ï¼ˆæ¨èç”¨äºæ–°é¡¹ç›®ï¼‰
å¦‚æœä½ æ‰“ç®—åˆ›å»ºä¸€ä¸ªæ–°çš„ Django é¡¹ç›®ï¼Œé¦–å…ˆéœ€è¦åˆå§‹åŒ–ä¸€ä¸ªé¡¹ç›®ï¼š

bash
ç¼–è¾‘
# åˆå§‹åŒ–ä¸€ä¸ªæ–°çš„é¡¹ç›®ï¼Œç”Ÿæˆ pyproject.toml
uv init

# ç„¶åæ·»åŠ  django ä½œä¸ºä¾èµ–
uv add django
ä¹‹åä½ å¯ä»¥ç”¨ django-admin startproject myproject . æ¥åˆ›å»º Django é¡¹ç›®ç»“æ„ã€‚

æ–¹æ³•äºŒï¼šä½¿ç”¨ --python æŒ‡å®šç¯å¢ƒå¹¶åˆ›å»ºé¡¹ç›®
æ›´å¸¸è§çš„åšæ³•æ˜¯å…ˆç¡®ä¿æœ‰åˆé€‚çš„ Python ç¯å¢ƒï¼š

bash
ç¼–è¾‘
# åˆ›å»ºä¸€ä¸ªè™šæ‹Ÿç¯å¢ƒï¼ˆå¯é€‰ï¼Œä½†æ¨èï¼‰
uv venv .venv
source .venv/bin/activate  # Linux/macOS
# æˆ–
.venv\Scripts\activate     # Windows

# æ·»åŠ  django åˆ°å½“å‰ç¯å¢ƒï¼ˆå³ä½¿æ²¡æœ‰ pyproject.tomlï¼‰
uv pip install django
æ³¨æ„ï¼šè¿™é‡Œä½¿ç”¨çš„æ˜¯ uv pip install è€Œä¸æ˜¯ uv addã€‚uv pip install çš„è¡Œä¸ºç±»ä¼¼äº pip installï¼Œå¯ä»¥ç›´æ¥å®‰è£…åŒ…è€Œä¸éœ€è¦ pyproject.tomlã€‚

æ–¹æ³•ä¸‰ï¼šåœ¨å·²æœ‰é¡¹ç›®ä¸­ä½¿ç”¨ uv add
å¦‚æœä½ å·²ç»æœ‰ä¸€ä¸ªé¡¹ç›®ï¼Œç¡®ä¿ä½ åœ¨é¡¹ç›®çš„æ ¹ç›®å½•ä¸‹æ‰§è¡Œå‘½ä»¤ï¼Œä¸”è¯¥ç›®å½•åŒ…å« pyproject.tomlã€‚å¦‚æœæ²¡æœ‰ï¼Œå¯ä»¥æ‰‹åŠ¨åˆ›å»ºæˆ–ä½¿ç”¨ uv init ç”Ÿæˆã€‚

æ€»ç»“
uv add éœ€è¦ pyproject.toml æ–‡ä»¶ï¼Œå› ä¸ºå®ƒç”¨äºç®¡ç†é¡¹ç›®çš„ä¾èµ–ã€‚
å¦‚æœä½ åªæ˜¯æƒ³å¿«é€Ÿå®‰è£… Djangoï¼Œä½¿ç”¨ uv pip install django æ›´ç›´æ¥ã€‚
å¦‚æœä½ è¦å¼€å§‹ä¸€ä¸ªæ–°é¡¹ç›®ï¼Œå…ˆè¿è¡Œ uv init åˆ›å»ºé¡¹ç›®ç»“æ„ã€‚
âœ… æ¨èæµç¨‹ï¼š

bash
ç¼–è¾‘
uv venv .venv
source .venv/bin/activate
uv pip install django
django-admin startproject mysite .
python mysite/manage.py runserver
ä»£ç 
å¦‚ä½•åœ¨å·²æœ‰é¡¹ç›®ä¸­æ·»åŠ ä¾èµ–åŒ…ï¼Ÿ
ä¸ºä»€ä¹ˆ pyproject.toml å¯¹ uv é‡è¦ï¼Ÿ
å¦‚ä½•åˆ›å»ºä¸€ä¸ªç®€å•çš„ Python é¡¹ç›®ï¼Ÿ






å¦‚ä½•åœ¨å·²æœ‰é¡¹ç›®ä¸­æ·»åŠ ä¾èµ–åŒ…ï¼Ÿ
ä¸ºä»€ä¹ˆ pyproject.toml å¯¹ uv é‡è¦ï¼Ÿ
å¦‚ä½•åˆ›å»ºä¸€ä¸ªç®€å•çš„ Python é¡¹ç›®ï¼Ÿ
ä»¥ä¸‹æ˜¯é’ˆå¯¹ä½ æå‡ºçš„ä¸‰ä¸ªé—®é¢˜çš„è¯¦ç»†è§£ç­”ï¼š

1. å¦‚ä½•åœ¨å·²æœ‰é¡¹ç›®ä¸­æ·»åŠ ä¾èµ–åŒ…ï¼Ÿ
å¦‚æœä½ å·²ç»æœ‰ä¸€ä¸ª Python é¡¹ç›®ï¼Œå¹¶æƒ³ç”¨ uv æ¥ç®¡ç†ä¾èµ–ï¼Œå¯ä»¥æŒ‰ç…§ä»¥ä¸‹æ­¥éª¤æ“ä½œï¼š

âœ… å‰ææ¡ä»¶
ç¡®ä¿ä½ çš„é¡¹ç›®æ ¹ç›®å½•ä¸‹æœ‰ pyproject.toml æ–‡ä»¶ã€‚å¦‚æœæ²¡æœ‰ï¼Œè¯·å…ˆåˆ›å»ºï¼ˆè§ç¬¬3é—®ï¼‰ã€‚

âœ… æ·»åŠ ä¾èµ–åŒ…ï¼ˆå¦‚ Djangoã€requests ç­‰ï¼‰
bash
ç¼–è¾‘
# å®‰è£…å¹¶æ·»åŠ åˆ° pyproject.toml çš„ dependencies ä¸­
uv add django

# æ·»åŠ å¼€å‘ä¾èµ–ï¼ˆä¾‹å¦‚æµ‹è¯•ã€æ ¼å¼åŒ–å·¥å…·ï¼‰
uv add pytest --dev

# ä¸€æ¬¡æ€§æ·»åŠ å¤šä¸ªåŒ…
uv add requests black --dev
è¿™ä¼šè‡ªåŠ¨ä¿®æ”¹ pyproject.tomlï¼Œå¹¶å°†ä¾èµ–å†™å…¥ [project.dependencies] æˆ– [project.optional-dependencies]ã€‚

âœ… å®‰è£…é¡¹ç›®æ‰€æœ‰ä¾èµ–ï¼ˆä» pyproject.tomlï¼‰
bash
ç¼–è¾‘
uv install
è¿™ç±»ä¼¼äº pip install -r requirements.txtï¼Œä½†æ›´ç°ä»£ã€æ›´å¿«ã€‚

âœ… åŒæ­¥ç¯å¢ƒï¼ˆç¡®ä¿è™šæ‹Ÿç¯å¢ƒä¸ pyproject.toml ä¸€è‡´ï¼‰
bash
ç¼–è¾‘
uv sync
è¿™ä¸ªå‘½ä»¤ä¼šæ ¹æ® pyproject.toml å®‰è£…ç¼ºå¤±çš„åŒ…ï¼Œå¹¶ç§»é™¤å¤šä½™çš„åŒ…ï¼ˆä¿æŒç¯å¢ƒå¹²å‡€ï¼‰ã€‚

2. ä¸ºä»€ä¹ˆ pyproject.toml å¯¹ uv é‡è¦ï¼Ÿ
pyproject.toml æ˜¯ç°ä»£ Python é¡¹ç›®çš„æ ¸å¿ƒé…ç½®æ–‡ä»¶ï¼Œå¯¹ uv è‡³å…³é‡è¦ï¼ŒåŸå› å¦‚ä¸‹ï¼š

ä½œç”¨	è¯´æ˜
ğŸ“¦ ä¾èµ–å£°æ˜	uv é€šè¿‡ pyproject.toml ä¸­çš„ [project.dependencies] çŸ¥é“ä½ çš„é¡¹ç›®éœ€è¦å“ªäº›åŒ…ï¼ˆå¦‚ Djangoã€Flaskï¼‰ã€‚
ğŸ”„ å¯é‡å¤æ„å»º	ä»»ä½•äººæ‹¿åˆ°ä½ çš„é¡¹ç›®ï¼Œåªéœ€è¿è¡Œ uv install å°±èƒ½è¿˜åŸå®Œå…¨ç›¸åŒçš„ä¾èµ–ç¯å¢ƒã€‚
âš™ï¸ é¡¹ç›®å…ƒæ•°æ®	åŒ…å«é¡¹ç›®åç§°ã€ç‰ˆæœ¬ã€ä½œè€…ã€å…¥å£è„šæœ¬ç­‰ä¿¡æ¯ï¼Œä¾¿äºæ‰“åŒ…å’Œå‘å¸ƒã€‚
ğŸ”§ å·¥å…·é›†æˆ	æ”¯æŒ pytest, black, mypy ç­‰å·¥å…·çš„é…ç½®ï¼Œå®ç°ä¸€ä½“åŒ–å¼€å‘ä½“éªŒã€‚
ğŸš€ é«˜æ€§èƒ½è§£æ	uv åˆ©ç”¨ pyproject.toml å¿«é€Ÿè§£æä¾èµ–å…³ç³»ï¼Œæ¯”ä¼ ç»Ÿ pip æ›´å¿«æ›´å‡†ç¡®ã€‚
ğŸ“Œ ç®€å•è¯´ï¼š

pyproject.toml æ˜¯ uv çš„â€œé¡¹ç›®è¯´æ˜ä¹¦â€ã€‚æ²¡æœ‰å®ƒï¼Œuv ä¸çŸ¥é“ä½ åœ¨ç®¡ç†ä»€ä¹ˆé¡¹ç›®ï¼Œå› æ­¤ä¼šæŠ¥é”™ï¼šNo pyproject.toml foundã€‚

3. å¦‚ä½•åˆ›å»ºä¸€ä¸ªç®€å•çš„ Python é¡¹ç›®ï¼Ÿ
ä½¿ç”¨ uv å¯ä»¥éå¸¸å¿«é€Ÿåœ°åˆ›å»ºä¸€ä¸ªæ ‡å‡†çš„ Python é¡¹ç›®ï¼š

âœ… æ­¥éª¤ 1ï¼šåˆ›å»ºé¡¹ç›®ç›®å½•å¹¶è¿›å…¥
bash
ç¼–è¾‘
mkdir my-python-project
cd my-python-project
âœ… æ­¥éª¤ 2ï¼šåˆå§‹åŒ–é¡¹ç›®ï¼ˆç”Ÿæˆ pyproject.tomlï¼‰
bash
ç¼–è¾‘
uv init
å®ƒä¼šæç¤ºä½ è¾“å…¥é¡¹ç›®åã€ç‰ˆæœ¬ã€ä½œè€…ç­‰ä¿¡æ¯ï¼Œç„¶åç”Ÿæˆ pyproject.tomlã€‚

ä½ ä¹Ÿå¯ä»¥éäº¤äº’å¼åˆ›å»ºï¼š

bash
ç¼–è¾‘
uv init --name myproject --author "Your Name"
âœ… æ­¥éª¤ 3ï¼šåˆ›å»ºè™šæ‹Ÿç¯å¢ƒï¼ˆæ¨èï¼‰
bash
ç¼–è¾‘
uv venv .venv
source .venv/bin/activate  # Linux/macOS
# æˆ–
.venv\Scripts\activate     # Windows
âœ… æ­¥éª¤ 4ï¼šæ·»åŠ ä½ éœ€è¦çš„ä¾èµ–
bash
ç¼–è¾‘
uv add requests numpy    # ä¸»è¦ä¾èµ–
uv add pytest --dev      # å¼€å‘ä¾èµ–
âœ… æ­¥éª¤ 5ï¼šåˆ›å»ºä½ çš„ä»£ç æ–‡ä»¶
bash
ç¼–è¾‘
mkdir src
touch src/main.py
src/main.py ç¤ºä¾‹å†…å®¹ï¼š

python
ç¼–è¾‘
import requests

def fetch_data():
    response = requests.get("https://httpbin.org/json")
    print(response.json())

if __name__ == "__main__":
    fetch_data()
âœ… æ­¥éª¤ 6ï¼šè¿è¡Œé¡¹ç›®
bash
ç¼–è¾‘
python src/main.py
âœ… ï¼ˆå¯é€‰ï¼‰æ‰“åŒ…é¡¹ç›®
bash
ç¼–è¾‘
uv build
ç”Ÿæˆ dist/ ç›®å½•ä¸‹çš„ .whl å’Œ .tar.gz æ–‡ä»¶ï¼Œå¯ç”¨äºå‘å¸ƒã€‚

âœ… æ€»ç»“
ä»»åŠ¡	å‘½ä»¤
åˆå§‹åŒ–é¡¹ç›®	uv init
æ·»åŠ ä¾èµ–	uv add package_name
å®‰è£…æ‰€æœ‰ä¾èµ–	uv install
åˆ›å»ºè™šæ‹Ÿç¯å¢ƒ	uv venv .venv
è¿è¡Œä»£ç 	python your_script.py
ğŸ’¡ ä½¿ç”¨ uv + pyproject.toml æ˜¯ç°ä»£ Python å¼€å‘çš„æœ€ä½³å®è·µï¼Œè®©ä½ çš„é¡¹ç›®æ›´è§„èŒƒã€å¯ç»´æŠ¤ã€å¯å…±äº«ã€‚

ä»£ç 
å¦‚ä½•æ›´æ–°å·²æœ‰çš„ pyproject.toml æ–‡ä»¶ï¼Ÿ
uv å®‰è£…ä¾èµ–æ—¶æœ‰å“ªäº›æ³¨æ„äº‹é¡¹ï¼Ÿ
å¦‚ä½•æŸ¥çœ‹é¡¹ç›®ä¸­çš„ä¾èµ–å†²çªé—®é¢˜ï¼Ÿ





å¦‚ä½•æ›´æ–°å·²æœ‰çš„ pyproject.toml æ–‡ä»¶ï¼Ÿ
uv å®‰è£…ä¾èµ–æ—¶æœ‰å“ªäº›æ³¨æ„äº‹é¡¹ï¼Ÿ
å¦‚ä½•æŸ¥çœ‹é¡¹ç›®ä¸­çš„ä¾èµ–å†²çªé—®é¢˜ï¼Ÿ
ä»¥ä¸‹æ˜¯é’ˆå¯¹ä½ æå‡ºçš„ä¸‰ä¸ªé—®é¢˜çš„è¯¦ç»†è§£ç­”ï¼š

1. å¦‚ä½•æ›´æ–°å·²æœ‰çš„ pyproject.toml æ–‡ä»¶ï¼Ÿ
pyproject.toml æ˜¯ä¸€ä¸ªæ–‡æœ¬é…ç½®æ–‡ä»¶ï¼Œå¯ä»¥é€šè¿‡å¤šç§æ–¹å¼æ›´æ–°ã€‚

âœ… æ–¹æ³•ä¸€ï¼šä½¿ç”¨ uv add / uv removeï¼ˆæ¨èï¼‰
è¿™æ˜¯æœ€å®‰å…¨ã€æœ€æ¨èçš„æ–¹å¼ï¼Œuv ä¼šè‡ªåŠ¨å¤„ç†æ ¼å¼å’Œä¾èµ–ç‰ˆæœ¬ã€‚

bash
ç¼–è¾‘
# æ·»åŠ æ–°ä¾èµ–
uv add requests flask

# æ·»åŠ å¼€å‘ä¾èµ–
uv add pytest black --dev

# ç§»é™¤ä¾èµ–
uv remove flask
âœ… ä¼˜ç‚¹ï¼šè‡ªåŠ¨æ›´æ–° pyproject.tomlï¼Œå¹¶ç¡®ä¿è¯­æ³•æ­£ç¡®ã€‚

âœ… æ–¹æ³•äºŒï¼šæ‰‹åŠ¨ç¼–è¾‘ pyproject.toml
ä½ å¯ä»¥ç›´æ¥ç”¨æ–‡æœ¬ç¼–è¾‘å™¨æˆ–å‘½ä»¤è¡Œå·¥å…·ä¿®æ”¹æ–‡ä»¶ã€‚

ç¤ºä¾‹ pyproject.toml ç‰‡æ®µï¼š

toml
ç¼–è¾‘
[project]
name = "myapp"
version = "0.1.0"
dependencies = [
  "requests>=2.25.0",
  "django==4.2.0"
]

[project.optional-dependencies]
dev = [
  "pytest",
  "black",
  "flake8"
]
ğŸ“Œ æ‰‹åŠ¨ä¿®æ”¹æ³¨æ„äº‹é¡¹ï¼š

ä½¿ç”¨æ­£ç¡®çš„ TOML è¯­æ³•ï¼ˆå¦‚å­—ç¬¦ä¸²ç”¨åŒå¼•å·ï¼Œåˆ—è¡¨ç”¨ []ï¼‰ã€‚
ç‰ˆæœ¬çº¦æŸå»ºè®®ä½¿ç”¨ï¼š
django>=4.0ï¼šè‡³å°‘ 4.0
django==4.2.0ï¼šç²¾ç¡®ç‰ˆæœ¬
django~=4.2.0ï¼šå…¼å®¹ç‰ˆæœ¬ï¼ˆç­‰ä»·äº >=4.2.0, <4.3.0ï¼‰
âœ… æ–¹æ³•ä¸‰ï¼šä½¿ç”¨ uv add --editable å®‰è£…æœ¬åœ°åŒ…
å¦‚æœä½ æƒ³æŠŠä¸€ä¸ªæœ¬åœ°æ¨¡å—ä½œä¸ºä¾èµ–åŠ å…¥é¡¹ç›®ï¼š

bash
ç¼–è¾‘
uv add -e ./mypackage
è¿™ä¼šåœ¨ pyproject.toml ä¸­æ·»åŠ ä¸€æ¡å¯ç¼–è¾‘å®‰è£…çš„è·¯å¾„ä¾èµ–ã€‚

2. uv å®‰è£…ä¾èµ–æ—¶æœ‰å“ªäº›æ³¨æ„äº‹é¡¹ï¼Ÿ
è™½ç„¶ uv æ¯” pip æ›´å¿«æ›´å¼ºå¤§ï¼Œä½†ä»éœ€æ³¨æ„ä»¥ä¸‹å‡ ç‚¹ï¼š

æ³¨æ„äº‹é¡¹	è¯´æ˜ä¸å»ºè®®
ğŸ”¹ ç¡®ä¿åœ¨é¡¹ç›®æ ¹ç›®å½•è¿è¡Œ	uv add è¦æ±‚å½“å‰ç›®å½•æˆ–çˆ¶ç›®å½•å­˜åœ¨ pyproject.tomlï¼Œå¦åˆ™æŠ¥é”™ã€‚
ğŸ”¹ ä½¿ç”¨è™šæ‹Ÿç¯å¢ƒ	å»ºè®®å…ˆåˆ›å»ºéš”ç¦»ç¯å¢ƒï¼Œé¿å…æ±¡æŸ“å…¨å±€ Pythonï¼š
bash
ç¼–è¾‘
uv venv .venv
source .venv/bin/activate
``` |
| ğŸ”¹ **åŒºåˆ† `uv add` å’Œ `uv pip install`** |  
- `uv add`ï¼šä¿®æ”¹ `pyproject.toml`ï¼Œç”¨äºé¡¹ç›®ä¾èµ–ç®¡ç†ã€‚  
- `uv pip install`ï¼šä»…å®‰è£…åŒ…ï¼Œä¸è®°å½•åˆ°é¡¹ç›®æ–‡ä»¶ï¼ˆé€‚åˆä¸´æ—¶è°ƒè¯•ï¼‰ã€‚ |
| ğŸ”¹ **ç‰ˆæœ¬å†²çªé¢„é˜²** | ä½¿ç”¨ç²¾ç¡®ç‰ˆæœ¬æˆ–åˆç†èŒƒå›´ï¼Œé¿å… `*` é€šé…ç¬¦ã€‚`uv` ä¼šè‡ªåŠ¨è§£æä¾èµ–ï¼Œä½†ä¸åˆç†çš„çº¦æŸå¯èƒ½å¯¼è‡´å¤±è´¥ã€‚ |
| ğŸ”¹ **å¹³å°å…¼å®¹æ€§** | `uv` æ”¯æŒé¢„ç¼–è¯‘ wheelï¼Œä½†åœ¨æŸäº›å¹³å°ï¼ˆå¦‚ ARMã€æ—§ç³»ç»Ÿï¼‰å¯èƒ½éœ€è¦å›é€€åˆ°æºç æ„å»ºã€‚ |
| ğŸ”¹ **é”å®šæ–‡ä»¶ï¼ˆå¯é€‰ï¼‰** | `uv` é»˜è®¤ä¸ç”Ÿæˆ `uv.lock`ï¼Œä½†ä½ å¯ä»¥é€šè¿‡ `uv lock` ç”Ÿæˆé”å®šæ–‡ä»¶ä»¥ç¡®ä¿å¯é‡å¤æ„å»ºã€‚ |
| ğŸ”¹ **ç¦»çº¿æ¨¡å¼æ”¯æŒ** | ä½¿ç”¨ `--offline` å¯ç¦»çº¿å®‰è£…ï¼ˆéœ€æå‰ç¼“å­˜åŒ…ï¼‰ã€‚ |

ğŸ“Œ **æœ€ä½³å®è·µ**ï¼š
```bash
# æ¨èæµç¨‹
uv venv .venv
source .venv/bin/activate
uv add django requests  # è®°å½•åˆ° pyproject.toml
uv sync                 # ç¡®ä¿ç¯å¢ƒä¸€è‡´
3. å¦‚ä½•æŸ¥çœ‹é¡¹ç›®ä¸­çš„ä¾èµ–å†²çªé—®é¢˜ï¼Ÿ
ä¾èµ–å†²çªæ˜¯æŒ‡ä¸¤ä¸ªåŒ…ä¾èµ–äº†åŒä¸€ä¸ªåŒ…çš„ä¸åŒç‰ˆæœ¬ï¼Œå¯¼è‡´æ— æ³•åŒæ—¶æ»¡è¶³ã€‚

âœ… æ–¹æ³•ä¸€ï¼šuv è‡ªåŠ¨æ£€æµ‹ï¼ˆæœ€ç®€å•ï¼‰
å½“ä½ è¿è¡Œä»¥ä¸‹å‘½ä»¤æ—¶ï¼Œuv ä¼šè‡ªåŠ¨è§£æä¾èµ–å¹¶æŠ¥å‘Šå†²çªï¼š

bash
ç¼–è¾‘
uv add django requests
# æˆ–
uv install
å¦‚æœå­˜åœ¨å†²çªï¼Œä½ ä¼šçœ‹åˆ°ç±»ä¼¼è¾“å‡ºï¼š

text
ç¼–è¾‘
error: Failed to resolve dependencies:
  Because package-a depends on django==4.0 and package-b depends on django>=5.0, we cannot proceed.
âœ… æ–¹æ³•äºŒï¼šä½¿ç”¨ uv pip check æ£€æŸ¥å·²å®‰è£…åŒ…çš„å†²çª
bash
ç¼–è¾‘
uv pip check
è¾“å‡ºç¤ºä¾‹ï¼š

text
ç¼–è¾‘
requests 2.25.1 requires idna<3,>=2.5, but you have idna 3.1 which is incompatible.
è¿™èƒ½å‘ç°å·²å®‰è£…åŒ…ä¹‹é—´çš„ä¸å…¼å®¹é—®é¢˜ã€‚

âœ… æ–¹æ³•ä¸‰ï¼šä½¿ç”¨ uv lock --dry-run æ¨¡æ‹Ÿè§£æ
bash
ç¼–è¾‘
uv lock --dry-run
è¿™ä¼šå°è¯•ç”Ÿæˆä¾èµ–é”æ–‡ä»¶ï¼Œä½†ä¸ä¿å­˜ï¼Œå¯ç”¨äºæµ‹è¯•ä¾èµ–æ˜¯å¦èƒ½æˆåŠŸè§£æã€‚

âœ… æ–¹æ³•å››ï¼šæ‰‹åŠ¨åˆ†æä¾èµ–æ ‘ï¼ˆé«˜çº§ï¼‰
è™½ç„¶ uv ç›®å‰æ²¡æœ‰å†…ç½® tree å‘½ä»¤ï¼Œä½†ä½ å¯ä»¥ä½¿ç”¨ pip æŸ¥çœ‹ï¼š

bash
ç¼–è¾‘
uv pip install pipdeptree
pipdeptree
è¿™ä¼šæ˜¾ç¤ºå®Œæ•´çš„ä¾èµ–æ ‘ï¼Œå¸®åŠ©ä½ å®šä½å†²çªæ¥æºã€‚

âœ… æ€»ç»“
é—®é¢˜	è§£å†³æ–¹æ¡ˆ
æ›´æ–° pyproject.toml	ä½¿ç”¨ uv add/remove æˆ–æ‰‹åŠ¨ç¼–è¾‘
uv å®‰è£…æ³¨æ„äº‹é¡¹	ä½¿ç”¨è™šæ‹Ÿç¯å¢ƒã€åŒºåˆ† add ä¸ pip installã€é¿å…é€šé…ç¬¦
æŸ¥çœ‹ä¾èµ–å†²çª	uv install è‡ªåŠ¨æŠ¥é”™ã€uv pip checkã€uv lock --dry-runã€pipdeptree
ğŸ’¡ å»ºè®®å·¥ä½œæµï¼š

bash
ç¼–è¾‘
uv venv .venv
source .venv/bin/activate
uv add django requests pytest --dev
uv pip check  # æ£€æŸ¥å†²çª
uv sync       # åŒæ­¥ç¯å¢ƒ
è¿™æ ·å¯ä»¥ç¡®ä¿ä½ çš„é¡¹ç›®ä¾èµ–æ¸…æ™°ã€å¯ç»´æŠ¤ã€æ— å†²çªã€‚

ä»£ç 
å¦‚ä½•é¿å…ä¾èµ–å†²çªé—®é¢˜ï¼Ÿ
æœ‰å“ªäº›å·¥å…·å¯ä»¥æ£€æµ‹ä¾èµ–å†²çªï¼Ÿ
å¦‚ä½•åœ¨é¡¹ç›®ä¸­ç®¡ç†å¤šä¸ªè™šæ‹Ÿç¯å¢ƒï¼Ÿ








å¦‚ä½•é¿å…ä¾èµ–å†²çªé—®é¢˜ï¼Ÿ
æœ‰å“ªäº›å·¥å…·å¯ä»¥æ£€æµ‹ä¾èµ–å†²çªï¼Ÿ
å¦‚ä½•åœ¨é¡¹ç›®ä¸­ç®¡ç†å¤šä¸ªè™šæ‹Ÿç¯å¢ƒï¼Ÿ
ä»¥ä¸‹æ˜¯é’ˆå¯¹ä½ æå‡ºçš„ä¸‰ä¸ªé—®é¢˜çš„è¯¦ç»†è§£ç­”ï¼Œå¸®åŠ©ä½ æ›´é«˜æ•ˆã€å®‰å…¨åœ°ç®¡ç† Python é¡¹ç›®ä¾èµ–ã€‚

1. å¦‚ä½•é¿å…ä¾èµ–å†²çªé—®é¢˜ï¼Ÿ
ä¾èµ–å†²çªæ˜¯ç°ä»£è½¯ä»¶å¼€å‘ä¸­çš„å¸¸è§ç—›ç‚¹ã€‚ä»¥ä¸‹æ˜¯ä¸€äº›é¢„é˜²æ€§æœ€ä½³å®è·µï¼š

âœ… 1. ä½¿ç”¨è™šæ‹Ÿç¯å¢ƒéš”ç¦»é¡¹ç›®
æ¯ä¸ªé¡¹ç›®ä½¿ç”¨ç‹¬ç«‹çš„è™šæ‹Ÿç¯å¢ƒï¼Œé¿å…ä¸åŒé¡¹ç›®çš„ä¾èµ–äº’ç›¸å¹²æ‰°ã€‚

bash
ç¼–è¾‘
uv venv .venv
source .venv/bin/activate  # Linux/macOS
# æˆ–
.venv\Scripts\activate     # Windows
âœ… 2. æ˜ç¡®ç‰ˆæœ¬çº¦æŸï¼ˆä½†ä¸è¿‡äºä¸¥æ ¼ï¼‰
åœ¨ pyproject.toml ä¸­åˆç†è®¾ç½®ç‰ˆæœ¬èŒƒå›´ï¼š

toml
ç¼–è¾‘
[project.dependencies]
django = ">=4.2, <5.0"    # å…è®¸å°ç‰ˆæœ¬æ›´æ–°ï¼Œä½†ä¸è·¨å¤§ç‰ˆæœ¬
requests = "^2.28.0"      # ç­‰ä»·äº >=2.28.0, <3.0.0ï¼ˆè¯­ä¹‰åŒ–ç‰ˆæœ¬ï¼‰
black = "==23.7.0"        # å›¢é˜Ÿå¼€å‘æ—¶å¯é”å®šç²¾ç¡®ç‰ˆæœ¬
ğŸ“Œ æ¨èä½¿ç”¨ ^ å’Œ ~ è¿›è¡Œç‰ˆæœ¬æ§åˆ¶ï¼ˆTOML æ”¯æŒï¼‰ã€‚

âœ… 3. å®šæœŸæ›´æ–°ä¾èµ–
ä½¿ç”¨å·¥å…·å®šæœŸæ£€æŸ¥è¿‡æ—¶åŒ…ï¼ŒåŠæ—¶å‡çº§ä»¥å‡å°‘é•¿æœŸç§¯ç´¯çš„å†²çªé£é™©ï¼š

bash
ç¼–è¾‘
uv pip list --outdated
uv pip install --upgrade package-name
âœ… 4. ä½¿ç”¨ä¾èµ–è§£æå™¨ï¼ˆå¦‚ uv è‡ªå¸¦ï¼‰
uv ä½¿ç”¨ Rust ç¼–å†™çš„é«˜æ€§èƒ½ä¾èµ–è§£æå™¨ï¼Œèƒ½æ›´å¿«ã€æ›´å‡†ç¡®åœ°è§£å†³å¤æ‚ä¾èµ–å…³ç³»ï¼Œæ¯”ä¼ ç»Ÿ pip æ›´å¯é ã€‚

âœ… 5. é”å®šä¾èµ–ï¼ˆç”Ÿæˆ uv.lock æ–‡ä»¶ï¼‰
è™½ç„¶ uv é»˜è®¤ä¸ç”Ÿæˆé”æ–‡ä»¶ï¼Œä½†ä½ å¯ä»¥æ˜¾å¼åˆ›å»ºä»¥ç¡®ä¿å¯é‡å¤æ„å»ºï¼š

bash
ç¼–è¾‘
uv lock
uv sync  # åŸºäºé”æ–‡ä»¶å®‰è£…
è¿™èƒ½ç¡®ä¿æ‰€æœ‰å¼€å‘è€…å’Œç”Ÿäº§ç¯å¢ƒä½¿ç”¨å®Œå…¨ç›¸åŒçš„ä¾èµ–ç‰ˆæœ¬ã€‚

âœ… 6. é¿å…å…¨å±€å®‰è£…åŒ…
æ°¸è¿œä¸è¦ç”¨ pip install -g æˆ–ç›´æ¥æ“ä½œç³»ç»Ÿ Pythonï¼Œå§‹ç»ˆä½¿ç”¨è™šæ‹Ÿç¯å¢ƒã€‚

2. æœ‰å“ªäº›å·¥å…·å¯ä»¥æ£€æµ‹ä¾èµ–å†²çªï¼Ÿ
å·¥å…·	åŠŸèƒ½	å®‰è£…/ä½¿ç”¨æ–¹å¼
ğŸ”¹ uv pip check	æ£€æŸ¥å·²å®‰è£…åŒ…ä¹‹é—´çš„å…¼å®¹æ€§	uv pip check
ğŸ”¹ pip-check	äº¤äº’å¼æŸ¥çœ‹å“ªäº›åŒ…æœ‰å†²çªæˆ–å¯æ›´æ–°	pip install pip-check && pip-check
ğŸ”¹ pipdeptree	æ˜¾ç¤ºä¾èµ–æ ‘ï¼Œç›´è§‚å‘ç°å†²çªæ¥æº	
bash
ç¼–è¾‘
uv pip install pipdeptree
pipdeptree --warn conflict
``` |
| ğŸ”¹ `pip-audit` | æ£€æµ‹ä¾èµ–ä¸­çš„å®‰å…¨æ¼æ´ï¼ˆé—´æ¥å¸®åŠ©é¿å…é—®é¢˜åŒ…ï¼‰ |  
```bash
uv pip install pip-audit
pip-audit
``` |
| ğŸ”¹ `dependabot` / `renovate` | GitHub é›†æˆå·¥å…·ï¼Œè‡ªåŠ¨æ£€æµ‹è¿‡æ—¶å’Œå†²çªä¾èµ– | é…ç½® `.github/dependabot.yml` |
| ğŸ”¹ `poetry check` | å¦‚æœä½ ç”¨ Poetryï¼Œå®ƒæä¾› `poetry check` æ£€æŸ¥ `pyproject.toml` åˆæ³•æ€§ | `poetry check` |

ğŸ“Œ ç¤ºä¾‹ï¼šä½¿ç”¨ `pipdeptree` æŸ¥çœ‹å†²çª
```bash
pipdeptree --warn conflict
# è¾“å‡ºç¤ºä¾‹ï¼š
# Warning: django [required: ==4.0, installed: 4.2] 
#   requests [required: >=2.20, installed: 2.25]
3. å¦‚ä½•åœ¨é¡¹ç›®ä¸­ç®¡ç†å¤šä¸ªè™šæ‹Ÿç¯å¢ƒï¼Ÿ
è™½ç„¶ä¸€ä¸ªé¡¹ç›®é€šå¸¸åªéœ€ä¸€ä¸ªè™šæ‹Ÿç¯å¢ƒï¼Œä½†åœ¨æŸäº›åœºæ™¯ä¸‹å¯èƒ½éœ€è¦å¤šä¸ªç¯å¢ƒï¼ˆå¦‚æµ‹è¯•ä¸åŒ Python ç‰ˆæœ¬ã€ä¸åŒä¾èµ–ç»„åˆï¼‰ã€‚

âœ… åœºæ™¯ 1ï¼šä¸ºä¸åŒç›®çš„åˆ›å»ºå¤šä¸ªç¯å¢ƒï¼ˆæ¨èç»“æ„ï¼‰
bash
ç¼–è¾‘
# å¼€å‘ç¯å¢ƒ
uv venv .venv-dev
# ç”Ÿäº§æ¨¡æ‹Ÿç¯å¢ƒ
uv venv .venv-prod
# æµ‹è¯•ç¯å¢ƒï¼ˆPython 3.9ï¼‰
uv venv .venv-test-py39 --python python3.9
æ¿€æ´»å¯¹åº”ç¯å¢ƒï¼š

bash
ç¼–è¾‘
source .venv-dev/bin/activate
# æˆ–
source .venv-prod/bin/activate
âœ… åœºæ™¯ 2ï¼šä½¿ç”¨ uv ç®¡ç†å¤šç‰ˆæœ¬ Python ç¯å¢ƒ
uv æ”¯æŒæŒ‡å®šä¸åŒ Python ç‰ˆæœ¬åˆ›å»ºç¯å¢ƒï¼š

bash
ç¼–è¾‘
uv venv .venv-py310 --python python3.10
uv venv .venv-py311 --python python3.11
âœ… åœºæ™¯ 3ï¼šç»“åˆ direnv æˆ– just å®ç°è‡ªåŠ¨åŒ–åˆ‡æ¢
direnvï¼šæ ¹æ®ç›®å½•è‡ªåŠ¨æ¿€æ´»å¯¹åº” .venv
bash
ç¼–è¾‘
# .envrc
source .venv-dev/bin/activate
å®‰è£… direnv åï¼Œè¿›å…¥ç›®å½•è‡ªåŠ¨æ¿€æ´»ã€‚
justï¼šå®šä¹‰å¸¸ç”¨å‘½ä»¤åˆ«å
justfile
ç¼–è¾‘
dev:
  source .venv-dev/bin/activate && python app.py

test:
  source .venv-test/bin/activate && pytest
ä½¿ç”¨ï¼šjust dev
âœ… åœºæ™¯ 4ï¼šCI/CD ä¸­ä½¿ç”¨å¤šä¸ªç¯å¢ƒæµ‹è¯•
åœ¨ GitHub Actions ä¸­æµ‹è¯•å¤šä¸ªç¯å¢ƒï¼š

yaml
ç¼–è¾‘
jobs:
  test:
    strategy:
      matrix:
        python-version: [3.9, 3.10, 3.11]
    steps:
      - uses: actions/checkout@v4
      - uses: astral-sh/uv-actions/setup-uv@v3
      - run: uv venv --python ${{ matrix.python-version }}
      - run: uv pip install -e .
      - run: uv pip install pytest
      - run: uv run pytest
âœ… æ€»ç»“ï¼šä¾èµ–ç®¡ç†æœ€ä½³å®è·µæ¸…å•
ç›®æ ‡	æ¨èåšæ³•
âŒ é¿å…å†²çª	ä½¿ç”¨è™šæ‹Ÿç¯å¢ƒ + åˆç†ç‰ˆæœ¬çº¦æŸ + å®šæœŸæ›´æ–°
ğŸ” æ£€æµ‹å†²çª	uv pip check, pipdeptree, pip-audit
ğŸ”„ ç®¡ç†å¤šç¯å¢ƒ	ä¸åŒç”¨é€”ç”¨ä¸åŒ .venv-*ï¼Œé…åˆ just æˆ– CI è„šæœ¬
ğŸ§± å¯é‡å¤æ„å»º	ä½¿ç”¨ uv lock ç”Ÿæˆé”æ–‡ä»¶
ğŸš€ æé«˜æ•ˆç‡	ç”¨ uv æ›¿ä»£ pipï¼Œäº«å—æé€Ÿå®‰è£…
ğŸ’¡ ä¸€å¥è¯å»ºè®®ï¼š

â€œä¸€é¡¹ç›®ä¸€ç¯å¢ƒï¼Œä¸€ä¾èµ–ä¸€å£°æ˜ï¼Œå¸¸æ£€æŸ¥ï¼Œæ—©é”å®šã€‚â€

è¿™æ ·å¯ä»¥æœ€å¤§ç¨‹åº¦é¿å…ä¾èµ–åœ°ç‹±ï¼Œæå‡å¼€å‘ä½“éªŒå’Œéƒ¨ç½²ç¨³å®šæ€§ã€‚

ä»£ç 
å¦‚ä½•é€‰æ‹©åˆé€‚çš„è™šæ‹Ÿç¯å¢ƒéš”ç¦»æ–¹æ¡ˆï¼Ÿ
æœ‰å“ªäº›å·¥å…·å¯ä»¥ä¿®å¤ä¾èµ–å†²çªï¼Ÿ
å¦‚ä½•è®¾ç½®è‡ªåŠ¨æ›´æ–°ä¾èµ–çš„é¢‘ç‡ï¼Ÿ









å¦‚ä½•é€‰æ‹©åˆé€‚çš„è™šæ‹Ÿç¯å¢ƒéš”ç¦»æ–¹æ¡ˆï¼Ÿ
æœ‰å“ªäº›å·¥å…·å¯ä»¥ä¿®å¤ä¾èµ–å†²çªï¼Ÿ
å¦‚ä½•è®¾ç½®è‡ªåŠ¨æ›´æ–°ä¾èµ–çš„é¢‘ç‡ï¼Ÿ
ä»¥ä¸‹æ˜¯é’ˆå¯¹ä½ æå‡ºçš„ä¸‰ä¸ªé«˜çº§ä¾èµ–ç®¡ç†é—®é¢˜çš„è¯¦ç»†è§£ç­”ï¼Œå¸®åŠ©ä½ åœ¨å®é™…é¡¹ç›®ä¸­æ›´é«˜æ•ˆã€å®‰å…¨åœ°è¿›è¡Œ Python ç¯å¢ƒä¸ä¾èµ–ç®¡ç†ã€‚

1. å¦‚ä½•é€‰æ‹©åˆé€‚çš„è™šæ‹Ÿç¯å¢ƒéš”ç¦»æ–¹æ¡ˆï¼Ÿ
é€‰æ‹©å“ªç§éš”ç¦»æ–¹æ¡ˆå–å†³äºä½ çš„é¡¹ç›®è§„æ¨¡ã€å›¢é˜Ÿåä½œæ–¹å¼å’Œéƒ¨ç½²éœ€æ±‚ã€‚ä»¥ä¸‹æ˜¯å¸¸è§æ–¹æ¡ˆå¯¹æ¯”ä¸é€‰å‹å»ºè®®ï¼š

éš”ç¦»æ–¹æ¡ˆ	é€‚ç”¨åœºæ™¯	å·¥å…·ç¤ºä¾‹	ä¼˜ç‚¹	ç¼ºç‚¹
ğŸ”¹ uv venv / python -m venv
ï¼ˆç›®å½•çº§éš”ç¦»ï¼‰	å•ä¸ªé¡¹ç›®å¼€å‘ã€å­¦ä¹ ç”¨é€”	uv venv .venv	è½»é‡ã€æ ‡å‡†ã€æ— éœ€é¢å¤–å·¥å…·	å¤šé¡¹ç›®æ—¶éœ€æ‰‹åŠ¨ç®¡ç†è·¯å¾„
ğŸ”¹ pipenv
ï¼ˆPipfile + virtualenvï¼‰	å°å‹é¡¹ç›®ã€å¸Œæœ›æ•´åˆ pip å’Œ virtualenv	pipenv install django	è‡ªåŠ¨ç®¡ç† Pipfile å’Œç¯å¢ƒ	æ€§èƒ½è¾ƒæ…¢ï¼Œç¤¾åŒºæ´»è·ƒåº¦ä¸‹é™
ğŸ”¹ poetry
ï¼ˆpyproject.toml + è™šæ‹Ÿç¯å¢ƒï¼‰	ä¸­å¤§å‹é¡¹ç›®ã€éœ€è¦æ‰“åŒ…å‘å¸ƒ	poetry add django	ä¾èµ–è§£æå¼ºã€æ”¯æŒé”å®šã€å¯å‘å¸ƒåŒ…	å­¦ä¹ æ›²çº¿ç¨é«˜
ğŸ”¹ conda / mamba
ï¼ˆè·¨è¯­è¨€ç¯å¢ƒç®¡ç†ï¼‰	æ•°æ®ç§‘å­¦ã€æœºå™¨å­¦ä¹ ã€é Python ä¾èµ–	conda create -n myenv python=3.11	æ”¯æŒé Python åŒ…ï¼ˆå¦‚ C/C++ åº“ï¼‰ã€è·¨å¹³å°	ç¯å¢ƒè¾ƒå¤§ï¼ŒPython ç”Ÿæ€å…¼å®¹æ€§ç•¥å·®
ğŸ”¹ Docker å®¹å™¨
ï¼ˆå®Œå…¨éš”ç¦»ï¼‰	ç”Ÿäº§éƒ¨ç½²ã€CI/CDã€å¤šæœåŠ¡æ¶æ„	Dockerfile + docker run	ç¯å¢ƒå®Œå…¨ä¸€è‡´ã€å¯ç§»æ¤æ€§å¼º	å¯åŠ¨å¼€é”€å¤§ã€éœ€è¦å®¹å™¨çŸ¥è¯†
ğŸ”¹ .env + direnv
ï¼ˆè‡ªåŠ¨æ¿€æ´»ï¼‰	å¼€å‘è€…é¢‘ç¹åˆ‡æ¢é¡¹ç›®	echo "source .venv/bin/activate" > .envrc && direnv allow	è¿›å…¥ç›®å½•è‡ªåŠ¨æ¿€æ´»ç¯å¢ƒ	éœ€è¦å®‰è£… direnv
âœ… é€‰å‹å»ºè®®ï¼š
ğŸŸ¢ ä¸ªäººé¡¹ç›® / å¿«é€ŸåŸå‹ï¼šä½¿ç”¨ uv venv .venv + æ‰‹åŠ¨æ¿€æ´»ã€‚
ğŸŸ¡ å›¢é˜Ÿé¡¹ç›® / é•¿æœŸç»´æŠ¤ï¼šæ¨è uv æˆ– poetryï¼Œç»“åˆ pyproject.toml å’Œé”æ–‡ä»¶ã€‚
ğŸ”µ æ•°æ®ç§‘å­¦ / ç§‘ç ”é¡¹ç›®ï¼šä½¿ç”¨ conda æˆ– mambaï¼Œä¾¿äºç®¡ç† NumPyã€CUDA ç­‰å¤æ‚ä¾èµ–ã€‚
ğŸ”´ ç”Ÿäº§éƒ¨ç½² / å¾®æœåŠ¡ï¼šä½¿ç”¨ Dockerï¼Œç¡®ä¿å¼€å‘ã€æµ‹è¯•ã€ç”Ÿäº§ç¯å¢ƒä¸€è‡´ã€‚
ğŸ“Œ ç°ä»£è¶‹åŠ¿ï¼š

uv + pyproject.toml æ­£åœ¨æˆä¸ºæ–°çš„äº‹å®æ ‡å‡†ï¼Œå› å…¶æé€Ÿå®‰è£…ã€æ ‡å‡†å…¼å®¹ã€è½»é‡é«˜æ•ˆã€‚

2. æœ‰å“ªäº›å·¥å…·å¯ä»¥ä¿®å¤ä¾èµ–å†²çªï¼Ÿ
ä¾èµ–å†²çªæ— æ³•å®Œå…¨é¿å…ï¼Œä½†ä»¥ä¸‹å·¥å…·å¯ä»¥å¸®åŠ©ä½ è¯Šæ–­å¹¶è‡ªåŠ¨æˆ–åŠè‡ªåŠ¨ä¿®å¤ã€‚

å·¥å…·	åŠŸèƒ½	ä½¿ç”¨æ–¹å¼	æ˜¯å¦èƒ½è‡ªåŠ¨ä¿®å¤
ğŸ”§ uv å†…ç½®è§£æå™¨	ä½¿ç”¨å…ˆè¿›ç®—æ³•å°è¯•æ»¡è¶³æ‰€æœ‰çº¦æŸ	uv add package-a package-b	âœ… æ˜¯ï¼ˆè‡ªåŠ¨å›æº¯æ±‚è§£ï¼‰
ğŸ”§ pip-tools
ï¼ˆpip-compile + pip-syncï¼‰	ä» requirements.in ç”Ÿæˆæ— å†²çªçš„ requirements.txt		
bash
ç¼–è¾‘
pip install pip-tools
echo "django" > requirements.in
pip-compile
pip-sync
``` | âœ… æ˜¯ï¼ˆé€šè¿‡é”å®šç‰ˆæœ¬è§£å†³ï¼‰ |
| ğŸ”§ **`poetry`** | å¼ºå¤§çš„ SAT æ±‚è§£å™¨ï¼Œèƒ½å¤„ç†å¤æ‚ä¾èµ– | `poetry add django` | âœ… æ˜¯ï¼ˆå¤±è´¥æ—¶æç¤ºå†²çªï¼‰ |
| ğŸ”§ **`conda`** | è·¨è¯­è¨€ä¾èµ–è§£æå™¨ï¼Œé€‚åˆç§‘å­¦è®¡ç®—æ ˆ | `conda install numpy pandas` | âœ… æ˜¯ï¼ˆä½†ä¼˜å…ˆä½¿ç”¨ conda åŒ…ï¼‰ |
| ğŸ”§ **`pip check` / `uv pip check`** | ä»…æ£€æµ‹ï¼Œä¸ä¿®å¤ | `uv pip check` | âŒ å¦ï¼ˆåªæŠ¥å‘Šï¼‰ |
| ğŸ”§ **`pip-upgrade`** | å°è¯•å‡çº§å†²çªåŒ…åˆ°å…¼å®¹ç‰ˆæœ¬ | `pip install pip-upgrade && pip-upgrade .` | âš ï¸ åŠè‡ªåŠ¨ï¼ˆéœ€ç¡®è®¤ï¼‰ |

#### âœ… **å…¸å‹ä¿®å¤æµç¨‹ï¼ˆä½¿ç”¨ `pip-tools`ï¼‰**

```bash
# 1. å®šä¹‰é«˜å±‚ä¾èµ–ï¼ˆä¸æŒ‡å®šç‰ˆæœ¬ï¼‰
echo "django" > requirements.in
echo "djangorestframework" >> requirements.in

# 2. ç”Ÿæˆé”å®šæ–‡ä»¶ï¼ˆè‡ªåŠ¨è§£å†³å†²çªï¼‰
pip-compile requirements.in

# 3. å®‰è£…ç²¾ç¡®ç‰ˆæœ¬
pip-sync requirements.txt
ğŸ’¡ åŸç†ï¼špip-compile ä¼šé€’å½’è§£ææ‰€æœ‰ä¾èµ–ï¼Œå¹¶é€‰æ‹©ä¸€ç»„èƒ½å…±å­˜çš„ç‰ˆæœ¬ã€‚

âœ… ä½¿ç”¨ uv çš„â€œé‡è¯•â€ç­–ç•¥
å¦‚æœ uv add å¤±è´¥ï¼Œå¯ä»¥å°è¯•ï¼š

bash
ç¼–è¾‘
# æ¸…é™¤ç¼“å­˜åé‡è¯•
uv clean
uv add django

# æˆ–å°è¯•æ›´æ–°å·²å®‰è£…åŒ…
uv pip install --upgrade existing-package
uv add new-package
3. å¦‚ä½•è®¾ç½®è‡ªåŠ¨æ›´æ–°ä¾èµ–çš„é¢‘ç‡ï¼Ÿ
å®šæœŸæ›´æ–°ä¾èµ–æœ‰åŠ©äºè·å–å®‰å…¨è¡¥ä¸å’Œæ–°åŠŸèƒ½ï¼Œä½†ä¹Ÿå¯èƒ½å¼•å…¥ç ´åæ€§å˜æ›´ã€‚å› æ­¤éœ€å¹³è¡¡å®‰å…¨æ€§ä¸ç¨³å®šæ€§ã€‚

âœ… æ–¹æ³•ä¸€ï¼šä½¿ç”¨ GitHub Dependabotï¼ˆæ¨èï¼‰
åœ¨ .github/dependabot.yml ä¸­é…ç½®è‡ªåŠ¨æ›´æ–°ï¼š

yaml
ç¼–è¾‘
version: 2
updates:
  - package-ecosystem: "pip"
    directory: "/"
    schedule:
      interval: "weekly"        # æ¯å‘¨æ£€æŸ¥ä¸€æ¬¡
      # interval: "daily"      # æ¯å¤©ï¼ˆæ¿€è¿›ï¼‰
      # interval: "monthly"    # æ¯æœˆï¼ˆä¿å®ˆï¼‰
    open-pull-requests-limit: 10
    # åªæ›´æ–° dev ä¾èµ–
    # target-branch: "dev"
    # ignore:
    #   - dependency-name: "django"
    #     versions: ["5.x"]     # å¿½ç•¥ Django 5.x
âœ… ä¼˜ç‚¹ï¼š

è‡ªåŠ¨åˆ›å»º PR
æ˜¾ç¤º changelog å’Œå®‰å…¨æ¼æ´
å¯é…ç½®æ›´æ–°é¢‘ç‡å’Œå¿½ç•¥è§„åˆ™
âœ… æ–¹æ³•äºŒï¼šä½¿ç”¨ Renovate Bot
Renovate æ›´çµæ´»ï¼Œæ”¯æŒæ›´å¤šè¯­è¨€å’Œé…ç½®ï¼š

json
ç¼–è¾‘
{
  "extends": ["config:base"],
  "schedule": ["before 2am on Monday"],
  "packageRules": [
    {
      "depTypeList": ["devDependencies"],
      "automerge": true
    },
    {
      "updateTypes": ["patch", "minor"],
      "automerge": true
    }
  ]
}
âœ… æ–¹æ³•ä¸‰ï¼šæœ¬åœ°è„šæœ¬ + Cronï¼ˆè‡ªåŠ¨åŒ–æ£€æŸ¥ï¼‰
åˆ›å»ºä¸€ä¸ªæ£€æŸ¥è„šæœ¬ check-updates.pyï¼š

python
ç¼–è¾‘
import subprocess
import sys

def check_outdated():
    result = subprocess.run(
        ["uv", "pip", "list", "--outdated"],
        capture_output=True,
        text=True
    )
    if result.stdout.strip():
        print("âš ï¸ ä»¥ä¸‹åŒ…å¯æ›´æ–°ï¼š")
        print(result.stdout)
        sys.exit(1)  # è§¦å‘ CI å‘Šè­¦
    else:
        print("âœ… æ‰€æœ‰ä¾èµ–å‡ä¸ºæœ€æ–°")

if __name__ == "__main__":
    check_outdated()
ç„¶ååœ¨ CIï¼ˆå¦‚ GitHub Actionsï¼‰ä¸­æ¯å‘¨è¿è¡Œï¼š

yaml
ç¼–è¾‘
on:
  schedule:
    - cron: '0 0 * * 1'   # æ¯å‘¨ä¸€å‡Œæ™¨æ‰§è¡Œ
jobs:
  check-deps:
    runs-on: ubuntu-latest
    steps:
      - uses: actions/checkout@v4
      - uses: astral-sh/uv-actions/setup-uv@v3
      - run: python check-updates.py
âœ… æ€»ç»“ï¼šæœ€ä½³å®è·µå»ºè®®
ç›®æ ‡	æ¨èæ–¹æ¡ˆ
ç¯å¢ƒéš”ç¦»	å°é¡¹ç›®ç”¨ uv venvï¼Œå¤§é¡¹ç›®ç”¨ poetry æˆ– Docker
ä¿®å¤å†²çª	ä¼˜å…ˆä½¿ç”¨ uv æˆ– pip-tools è‡ªåŠ¨ç”Ÿæˆå…¼å®¹ä¾èµ–é›†
è‡ªåŠ¨æ›´æ–°	ä½¿ç”¨ Dependabot è®¾ç½® æ¯å‘¨æ›´æ–°ï¼Œå…³é”®é¡¹ç›®è®¾ä¸ºæ¯æœˆ
ğŸ“Œ é»„é‡‘æ³•åˆ™ï¼š

å¼€å‘é˜¶æ®µï¼šæ¯å‘¨è‡ªåŠ¨æ£€æŸ¥æ›´æ–°ï¼Œå°ç‰ˆæœ¬è‡ªåŠ¨åˆå¹¶ã€‚
ç”Ÿäº§é¡¹ç›®ï¼šæ¯æœˆäººå·¥å®¡æŸ¥æ›´æ–°ï¼Œé‡å¤§ç‰ˆæœ¬å•ç‹¬æµ‹è¯•ã€‚
å®‰å…¨æ¼æ´ï¼šç«‹å³å“åº”ï¼Œä½¿ç”¨ pip-audit + Dependabot å®ç°è‡ªåŠ¨åŒ–å‘Šè­¦ã€‚
è¿™æ ·æ—¢èƒ½ä¿æŒé¡¹ç›®ç°ä»£åŒ–ï¼Œåˆèƒ½æœ€å¤§é™åº¦é¿å…â€œä¾èµ–åœ°éœ‡â€ã€‚

```



# æ­å»ºé¡¹ç›®

django-admin startproject mysite

é…ç½®
1.DATABASES

```python
DATABASES = {
    'default': {
        'ENGINE': 'django.db.backends.postgresql',  # ä½¿ç”¨ PostgreSQL å¼•æ“
        'NAME': 'app',                              # æ•°æ®åº“åç§°
        'USER': 'admin',                            # æ•°æ®åº“ç”¨æˆ·å
        'PASSWORD': 'admin',                        # ç”¨æˆ·å¯†ç 
        'HOST': '192.168.1.8',                      # ä¸»æœºåœ°å€ï¼Œæœ¬åœ°å¯ç”¨ 'localhost' æˆ– '127.0.0.1'
        'PORT': '54321',                            # ç«¯å£å·ï¼Œé»˜è®¤ä¸º 5432
        'OPTIONS': {
            'connect_timeout': 10,                  # è¿æ¥è¶…æ—¶æ—¶é—´ï¼ˆç§’ï¼‰
            'sslmode': 'prefer',                    # SSL æ¨¡å¼ï¼ˆå¯é€‰ï¼‰
        },
        'ATOMIC_REQUESTS': False,                   # æ˜¯å¦å°†æ¯ä¸ªè§†å›¾åŒ…è£¹åœ¨äº‹åŠ¡ä¸­ï¼ˆæŒ‰éœ€å¼€å¯ï¼‰
        'AUTOCOMMIT': True,                         # Django é»˜è®¤å¯ç”¨è‡ªåŠ¨æäº¤
    }
}
```

2.æ•°æ®åº“é©±åŠ¨
pip install psycopg[binary]

å®‰å…¨å»ºè®®ï¼šä½¿ç”¨ç¯å¢ƒå˜é‡ï¼ˆç”Ÿäº§ç¯å¢ƒå¿…å¤‡ï¼‰
ä½¿ç”¨django-environ æˆ– python-decouple
pip install django-environ
åˆ›å»º.env  (åœ¨é¡¹ç›®ç›®å½•ä¸‹ä¸æ˜¯æ ¹ç›®å½•ä¸‹)
```
# .env
DATABASE_URL=postgres://admin:admin@192.168.1.8:54321/app
DEBUG=True
```

ä¿®æ”¹settings.py
```python
import environ

env = environ.Env()
environ.Env.read_env()

DATABASES = {
    'default': env.db(),  # è‡ªåŠ¨è§£æ DATABASE_URL
}

DEBUG = env.bool('DEBUG', default=False)
```

æµ‹è¯•æ•°æ®åº“è¿æ¥
python manage.py dbshell
å¦‚æœæˆåŠŸå°±è¿›å…¥pgå‘½ä»¤è¡Œ

æˆ–è€…æ£€æŸ¥è¿ç§»çŠ¶æ€
python manage.py showmigrations

è¿›å…¥å®¹å™¨ä¸­çš„pg
podman exec -it postgres psql -U admin -d app



æ•°æ®åº“è¿ç§»
python manage.py makemigrations
python manage.py migrate


æœ€å°åŒ–å¯åŠ¨
mysite/mysite/settings.py
```python
INSTALLED_APPS = [
    'django.contrib.auth',
    'django.contrib.contenttypes',
]

MIDDLEWARE = []
```
mysite/mysite/urls.py
```python
from django.urls import path
urlpatterns = []
```

python manage.py runserver 0.0.0.0:8084

settings.py
```python
# ALLOWED_HOSTS = ['*']
ALLOWED_HOSTS = ['192.168.1.8']
```

å‘Šè¯‰djangoä»¥ç‰¹å®šIPç«¯å£å’Œé…ç½®æ–‡ä»¶è¿è¡Œç¨‹åºï¼š
python manage.py runserver 192.168.1.8:8083 --settings=mysite.settings

./core/management/__init__.py:372:        parser.add_argument("--settings")


åˆ›å»ºåº”ç”¨
python manage.py startapp blog

cp mysite/urls.py blog/
```python
from django.urls import path
from views import Xxx

urlpatterns = [
    path('/',Xxx.as_view())
]
```

è®¾ç½®ä¸»é”®primary_key=True

å®šä¹‰æ¨¡å‹ç±»
```python
from django.db import models

class Post(models.Model):
    title=models.CharField(max_length=250)
    slug=models.SlugField(max_length=250)
    body=models.TextField()

    def __str__(self):#ç”¨æ¥æ‰“å°å¯¹è±¡çš„å±æ€§
        return f"{self.__class__.__name__}({self.title})"

```        


æ³¨å†Œåº”ç”¨
```python
INSTALLED_APPS = [
    'blog.apps.BlogConfig',#BlogConfigæ˜¯åº”ç”¨é…ç½®ç±»ï¼Œæ³¨å†ŒådjangoçŸ¥é“å¦‚ä½•åŠ è½½æ¨¡å‹ç±»
]
```



# åå°ç®¡ç†
å‰åç«¯åˆ†ç¦»å¼€å‘ç”¨ä¸åˆ°

åˆ›å»ºç®¡ç†å‘˜ï¼špython manage.py createsuperuser  #åŠ åˆ°auth_userè¡¨ä¸­

äº†è§£å³å¯
```python
#admin.py
from django.contrib import admin
from .models import Post

@admin.register(Post)
class PostAdmin(admin.ModelAdmin):
    list_display=['title','slug','author','publish','status']
    list_filter=['status','created','publish','author']#æŒ‰å“ªäº›å­—æ®µè¿‡æ»¤
    search_fields=['title','body']#åœ¨å“ªé‡Œæœç´¢ï¼Œå¯ä»¥æ˜¯['title']
    prepopulated_fields={'slug':('title',)}#è‡ªåŠ¨å¡«å……ï¼Œä¾èµ–æŒ‡å®šå­—æ®µè‡ªåŠ¨å¡«å……slugï¼Œå¯ä»¥æ˜¯{'slug':("title", "category")}
    raw_id_fields=['author']#ç”¨ä¸€ä¸ªè¾“å…¥æ¡†ä»£æ›¿ä¸‹æ‹‰é€‰æ‹©æ¡†ï¼Œè®©ä½ é€šè¿‡è¾“å…¥ä¸»é”®ï¼ˆIDï¼‰æ¥æŒ‡å®šå…³è”å¯¹è±¡ï¼Œè€Œä¸æ˜¯åŠ è½½å…¨éƒ¨å¯¹è±¡(æ¯”å¦‚100k+)çš„ä¸‹æ‹‰åˆ—è¡¨ï¼Œå¯ä»¥å†™æˆ: raw_id_fields = ("author", "category", "tags")
    date_hierarchy='publish'#æ—¥æœŸå±‚çº§å¯¼èˆªæ ï¼Œå…è®¸æŒ‰ç…§ å¹´ â†’ æœˆ â†’ æ—¥ é€çº§ç­›é€‰æ•°æ®  ç®¡ç†åå°ä¸ºæ¨¡å‹æ·»åŠ åŸºäºæ—¥æœŸçš„å¯¼èˆªå±‚çº§ï¼ˆæ—¶é—´è½´ï¼‰ï¼Œè®©ç”¨æˆ·å¯ä»¥æŒ‰å¹´ã€æœˆã€æ—¥é€çº§ç­›é€‰æ•°æ®
    ordering=['status','-publish']
    show_facets=admin.ShowFacets.ALWAYS#æ€»æ˜¾ç¤ºåˆ†ç±»ç»Ÿè®¡facets
    

# admin.site.register(Post)#å¾€ç®¡ç†ç«™ç‚¹æ³¨å†Œæ¨¡å‹ç±»ï¼Œä¸è£…é¥°å™¨å†™æ³•äºŒé€‰ä¸€ï¼Œå³ä¹Ÿå¯ä»¥å†™æˆ@admin.register(Post)
```


æ¨¡å‹ç±»
```python
from django.db import models
from django.utils import timezone
from django.db.models.functions import Now
from django.conf import settings
from utils.db import schema_table


class BaseModel(models.Model):
    # created=models.DateTimeField(auto_now_add=True,default=timezone.now)#ç¬¬ä¸€æ¬¡æ·»åŠ è®°å½•çš„æ—¶é—´ï¼ˆåªèƒ½æ·»åŠ ä¸€æ¬¡addï¼‰
    created=models.DateTimeField(editable=False,default=timezone.now)#ç¬¬ä¸€æ¬¡æ·»åŠ è®°å½•çš„æ—¶é—´ï¼ˆåªèƒ½æ·»åŠ ä¸€æ¬¡addï¼‰
    updated=models.DateTimeField(auto_now=True)#å½“å‰æ›´æ–°çš„æ—¶é—´ï¼ˆæ›´æ–°å¤šæ¬¡ï¼‰
    deleted=models.DateTimeField(default=None,null=True,blank=True)

    class Meta:
        abstract=True#æŠ½è±¡åŸºç±»ï¼Œä¸ç”Ÿæˆè¡¨

class Post(BaseModel):
    class Status(models.TextChoices):
        # name=value,label
        DRAFT='DF','Draft'  # æšä¸¾åå­—=æšä¸¾å€¼,å¯è¯»å­—ç¬¦ä¸²ï¼Œé€šè¿‡Post.Status.valuesè·å–é€‰é¡¹çš„å€¼
        PUBLISHED='PB','Published'
        
    title=models.CharField(max_length=250)
    slug=models.SlugField(max_length=250)
    body=models.TextField()
    # publish=models.DateTimeField(default=timezone.now)#æ ¹æ®æ˜¯å¦é…ç½®æ—¶åŒºUSE_TZè€Œå®šæ˜¯å¦å¸¦æ—¶åŒº
    # å®ç°ä»£ç ï¼šdatetime.now(tz=timezone.utc if settings.USE_TZ else None)
    publish=models.DateTimeField(db_default=Now())#db_defaultä½¿ç”¨æ•°æ®åº“å‡½æ•°è¿”å›æ•°å€¼ï¼Œå¯¹äºpgæ¥è¯´å°±æ˜¯select STATEMENT_TIMESTAMP()ï¼Œå¯¹äºmysqlæ¥è¯´å°±æ˜¯select CURRENT_TIMESTAMP(6)
    status=models.CharField(max_length=2,choices=Status,default=Status.DRAFT)
    author=models.ForeignKey(
        settings.AUTH_USER_MODEL,  # global_settings.pyä¸­AUTH_USER_MODEL = "auth.User"
        on_delete=models.CASCADE,
        related_name='blog_posts'  # ä»å…³è”æ¨¡å‹åå‘è®¿é—®å½“å‰æ¨¡å‹æ—¶æ‰€ä½¿ç”¨çš„å±æ€§åï¼Œå¤–é”®é»˜è®¤è‡ªåŠ¨åˆ›å»ºåå‘å…³ç³»ï¼Œé»˜è®¤åå‘å…³ç³»åå­—ï¼šå°å†™æ¨¡å‹å_setï¼Œå¦‚user.post_set
    )
    
    class Meta:
        # db_tablespace='mysite'  #è¡¨ç©ºé—´ï¼Œç‰©ç†éš”ç¦»ï¼Œschemaåˆ™æ˜¯é€»è¾‘éš”ç¦»ï¼Œç›¸å½“äºåå­—ç©ºé—´ï¼Œä¸€èˆ¬ä¸åŒé¡¹ç›®æˆ–ç§Ÿæˆ·ç”¨schema
        db_table=schema_table('posts')
        ordering=['-publish']#æœ€å…ˆæ·»åŠ çš„æ”¾åœ¨æœ€ä¸Šé¢
        indexes=[
            models.Index(fields=['-publish']),#æ·»åŠ ç´¢å¼•
        ]
    
    def __str__(self):#ç”¨æ¥æ‰“å°å¯¹è±¡çš„å±æ€§
        return f"{self.__class__.__name__}({self.title})"

```        
from django.contrib.auth.models import User
from blog.models import Post
user=User.objects.get(username='admin')#æ²¡æœ‰å°±æŠ› DoesNotExist å¼‚å¸¸ï¼Œæœ‰å¤šä¸ªå°±æŠ› MultipleObjectsReturned å¼‚å¸¸
post=Post(title='Another post',slug='another-post',body='Post body.',author=user)#è¿™é‡Œauthor=userè¡¨ç¤ºå¾€æ•°æ®è¡¨postsä¸­å†™å…¥author_idæ˜¯auth_userè¡¨çš„id  è¿™æ—¶ä»ç„¶åœ¨å†…å­˜ä¸­
post.save()#åªæœ‰save()æ‰è½ç›˜

Post.objects.create(title='One more post',slug='one-more-post',body='Post body.',author=user)#ä½¿ç”¨create()åˆ™å°†åœ¨å†…å­˜ä¸­åˆ›å»ºå¯¹è±¡å’Œè½ç›˜ä¸¤ä¸ªåŠ¨ä½œåˆäºŒä¸ºä¸€
user,created=User.objects.get_or_create(username='user2')#å…ˆæŸ¥è¯¢æ‰¾ä¸åˆ°æ‰æ·»åŠ 
post.title='New title'
post.save()


æ¨¡å‹ç±»ç®¡ç†å™¨objects
all_posts=Post.objects.all()
posts=Post.objects.filter(title='New title')
print(posts.query)#æ‰“å°sql

æŸ¥è¯¢è¿‡æ»¤å™¨
Post.objects.filter(title__iexact='New title')#å¤§å°å†™ä¸æ•æ„Ÿinsensitive

#sqlä¸ºï¼šSELECT "mysite"."posts"."author_id" FROM "mysite"."posts" 
#WHERE "mysite"."posts"."title"::text LIKE %new% ORDER BY "mysite"."posts"."publish" DESC
Post.objects.filter(title__contains='New')

Post.objects.filter(title__icontains='new')
Post.objects.filter(id__in=[1,3])#ç¿»è¯‘æˆ where id in (1,3)
Post.objects.filter(id__gt=3)#ç¿»è¯‘æˆï¼šid>3
Post.objects.filter(id__gte=3)
Post.objects.filter(id__lt=3)
Post.objects.filter(title__istartswith='new')#ç¿»è¯‘ï¼šwhere upper(title::text) like upper(new%)
from datetime import date
Post.objects.filter(publish__date=date(2025,10,28))#ç¿»è¯‘ï¼š WHERE ("mysite"."posts"."publish" AT TIME ZONE UTC)::date = 2025-10-28
Post.objects.filter(publish__year=2025)
Post.objects.filter(publish__month=9)#ç¿»è¯‘ï¼š WHERE EXTRACT(MONTH FROM "mysite"."posts"."publish" AT TIME ZONE UTC) = 10
Post.objects.filter(publish__day=29)
Post.objects.filter(publish__date__gt=date(2025,10,28))#ç¿»è¯‘ï¼šWHERE ("mysite"."posts"."publish" AT TIME ZONE UTC)::date > 2025-10-28
Post.objects.filter(author__username='admin')

#ç¿»è¯‘ï¼šFROM "mysite"."posts" INNER JOIN "auth_user" ON ("mysite"."posts"."author_id" = "auth_user"."id") 
#WHERE "auth_user"."username"::text LIKE ad%

#FROM "mysite"."posts" INNER JOIN "auth_user" ON ("mysite"."posts"."author_id" = "auth_user"."id")    å…³è”æŸ¥è¯¢
#WHERE ("auth_user"."username"::text LIKE ad% AND "mysite"."posts"."publish" BETWEEN 2025-01-01 00:00:00+00:00 AND 2025-12-31 23:59:59.999999+00:00)
Post.objects.filter(author__username__startswith='ad',publish__year=2025)
#è¿˜å¯ä»¥å†™æˆé“¾å¼è°ƒç”¨å½¢å¼
Post.objects.filter(author__username__startswith='ad').filter(publish__year=2025)
Post.objects.filter(publish__year=2025).exclude(title__startswith='New')#å…³é”®ç‚¹ï¼šNOT ...::text LIKE New%
Post.objects.order_by('author','-publish','-title')  # ORDER BY
Post.objects.all()[:3]
Post.objects.all()[1:3]#è¦ç‚¹ï¼šLIMIT 2 OFFSET 1ï¼Œå–çš„æ˜¯ç¬¬1ã€2ä¸¤æ¡
Post.objects.filter(id__lt=3).count()#count()æ˜¯å¯¹å‰é¢çš„QuerySetå¯¹è±¡å–len()å¾—åˆ°çš„ï¼Œæ‰€ä»¥è¦æ”¾åœ¨é“¾å¼è°ƒç”¨çš„æœ€å
Post.objects.filter(title__startswith='åˆè¯†').exists()
post=Post.objects.get(id=10)
post.delete()#æ³¨æ„ï¼šåˆ é™¤æ—¶å¤–é”®è®¾ç½®äº†on_delete=CASCADEä¹Ÿä¼šè”åŠ¨åˆ é™¤

from django.db.models import Q
starts_who=Q(title__istartswith='who')#Qç”¨æ¥æ„é€ æ¡ä»¶
starts_why=Q(title__istartswith='why')
Post.objects.filter(starts_who|starts_why)#å…³é”®ç‚¹ï¼šwhere æ¡ä»¶1 or æ¡ä»¶2

ä½•æ—¶çœŸæ­£æ‰§è¡ŒæŸ¥è¯¢ï¼Ÿ
- éå†è¿­ä»£
- åˆ‡ç‰‡
- ç¼“å­˜pickle/cache
- repr() - å¯¹åº”äºæ‰“å°qså¯¹è±¡,len() - å¯¹åº”äºcount()
- list()
- bool(),or,and,if - å¯¹åº”äºexists()


åˆ›å»ºæ¨¡å‹ç®¡ç†å™¨
- 1.æ·»åŠ ç®¡ç†å™¨æ–¹æ³•åˆ°ç°å­˜ç®¡ç†å™¨objectsä¸Š: Post.objects.my_manager()
- 2.åˆ›å»ºä¸€ä¸ªæ–°çš„ç®¡ç†å™¨: Post.my_manager.all()

from blog.models import Post
posts=Post.published.filter(title__startswith='åˆè¯†')

```python
class PublishedManager(models.Manager):
    def get_queryset(self):
        return (
            super().get_queryset().filter(status=Post.Status.PUBLISHED)
        )
        
class Post(BaseModel):
    objects=models.Manager()#é»˜è®¤ç®¡ç†å™¨
    published=PublishedManager()#è‡ªå®šä¹‰ç®¡ç†å™¨
```        


### path converter
<int:id>  ç”¨äºè·¯å¾„å‚æ•°


è·¯ç”±é…ç½®
æ€»è·¯ç”±
```python
from django.urls import path,include

urlpatterns = [
    path('/blog',include('blog.urls'),namespace='blog')
]
```
å­è·¯ç”±
```python
from django.urls import path
from . import views

app_name='blog'

urlpatterns = [
    path('',views.post_list,name='post_list'),
    path('<int:id>/',views.post_detail,name='post_detail'),
]
```


è¯´æ˜ï¼š
æŒ‡å®šè¿ç§»ç‰¹å®šåº”ç”¨ï¼špython manage.py makemigrations blog
æ‰§è¡Œè¿ç§»ï¼špython manage.py migrate
æŸ¥çœ‹è¿ç§»è®¡åˆ’(æ‰§è¡Œçš„sqlè¿ç§»å‰æ£€æŸ¥æ˜¯å¦é”™è¯¯)ï¼špython manage.py sqlmigrate blog 0001
æŒ‰ç…§æŒ‡å®šé…ç½®IPç«¯å£å¯æœåŠ¡ï¼špython manage.py runserver 0.0.0.0:8081 --settings=mysite.settings
è¿è¡Œdjango shellç”¨äºæ£€æŸ¥ç»“æœé›†æµ‹è¯•æ€§èƒ½:python manage.py shell 
åˆ›å»ºç®¡ç†å‘˜ï¼špython manage.py createsuperuser


æ•°æ®è¿ç§»ä¸ä¸€å®šæ˜¯æ•°æ®åº“å˜åŒ–ï¼Œæœ‰æ—¶æ¨¡å‹ç±»æ”¹å˜ä¹Ÿè¦è¿ç§»ï¼Œå³æ•°æ®è¿ç§»é¦–å…ˆæ˜¯ä¿è¯ä¸æ¨¡å‹ç±»ä¸€è‡´


åˆ†é¡µé€»è¾‘
- previous_page_number
- next_page_number
- number
- paginator.num_pagesï¼šé¡µç è¶…é™è¿”å›æœ€åä¸€é¡µ
- has_previous
- has_next


æ¨¡æ¿ç»§æ‰¿ï¼š{% extends "x/y.html" %}
å—ï¼š{% block å­—æ®µå %}{% endblock %}
å¾ªç¯ï¼š{% for i in data %}æœ‰æ•°æ®{% empty %}æ²¡æœ‰æ•°æ®{% endfor %}
æ¡ä»¶ï¼š{% if æ¡ä»¶ %}{% else %}{% endif %}
æ¨¡æ¿å˜é‡ï¼š{{ x.a }}
å¯¼å…¥æ¨¡æ¿ï¼š{% include "x.html" with x=x1 y=y1 %}
è¿‡æ»¤å™¨ï¼š{{ x.a|truncatewords:n|linebreaks }}





### è¡¨å•
æ ¡éªŒç”¨is_valid()
- 1.å…¨éƒ¨å­—æ®µéƒ½é€šè¿‡æ ¡éªŒåˆ™é€šè¿‡æ ¡éªŒï¼Œæ ¡éªŒåæ•°æ®form.cleaned_data
- 2.åªè¦ä¸€é¡¹æ²¡é€šè¿‡æ ¡éªŒåˆ™ä¸é€šè¿‡æ ¡éªŒï¼ŒæŠ¥é”™ä¿¡æ¯åœ¨form.errorsä¸­






{{ form.as_p }}:  æŠŠè¡¨å•çš„æ¯ä¸€é¡¹æ¸²æŸ“æˆpå…ƒç´ ï¼Œå…¶å®ƒè¿˜æœ‰as_ul, as_table
{% csrf_token %}: csrfé˜²æŠ¤ï¼ŒåŸç†ï¼šä¸ç”Ÿæˆçš„å«csrfmiddlewaretokençš„tokenè¿›è¡Œæ¯”è¾ƒï¼Œä¸€è‡´å°±æ”¾è¡Œå¦åˆ™æ‹¦æˆªï¼ŒPOSTè¯·æ±‚éƒ½æ£€æŸ¥csrf
{% with comments.count as total_comments %}{% endwith %}: å®šä¹‰ä½œç”¨åŸŸå’Œå†…éƒ¨å˜é‡ï¼Œå‡½æ•°è°ƒç”¨ä¸éœ€è¦æ‹¬å·ï¼Œwithå¥½å¤„æ˜¯å‡å°‘å¯¹æ•°æ®åº“çš„è®¿é—®ï¼ˆç¼“å­˜/æ‡’åŠ è½½ï¼Ÿï¼‰
{{form.x.as_field_group}}: ç”¨æ¥ç®€åŒ–django5ä¹‹å‰ç¹æ‚çš„è¡¨å•ç¼–å†™ï¼Œå¦‚field,field.errors,field.label_tag,field.help_textç­‰ç¼–å†™å¯ä»¥ç”¨as_field_groupæ¥ä»£æ›¿è€Œä¸”ä¹Ÿä¸éœ€è¦å†™forå¾ªç¯äº†

djangoä¸­å¤„ç†é‚®ä»¶æ”¶å‘å¯ç”¨django-anymail







æ‰©å±•åšå®¢åº”ç”¨
uv pip install django-taggit
æ³¨å†Œtaggit
æ¨¡å‹ç±»ä¸­å¢åŠ å­—æ®µï¼štags=TaggableManager()
æ•°æ®è¿ç§»(åªè¦è¡¨å­—æ®µæ”¹å˜å¿…åšmakemigrations+migrate)ï¼Œè¡¨å­—æ®µä¸å˜åªåšmakemigrationsä¸åšmigrate
å¢åŠ tag
python manage.py shell
from blog.models import Post
post=Post.objects.get(id=1)
#tagså°±æ˜¯django-taggitå®šä¹‰çš„ç®¡ç†å™¨
post.tags.add('music','jazz','django')
post.tags.all()
post.tags.remove('django')









## è‡ªå®šä¹‰æ¨¡æ¿æ ‡ç­¾

```python
from django import template
register=template.Library()
@register.inclusion_tag('blog/post/latest_posts.html')
def show_latest_posts(count=5):
    latest_posts=Post.published.order_by('-publish')[:count]
    return {'latest_posts':latest_posts}

@register.simple_tag
def get_most_commented_posts(count=5):
    return Post.published.annotate(
        total_comments=Count('comments')
    ).order_by('-total_comments')[:count]
```    

ä½¿ç”¨
```html
{# é€šè¿‡asæŠŠå‡½æ•°æ‰§è¡Œç»“æœä¿å­˜æˆå˜é‡ #}
{% get_most_commented_posts as most_commented_posts %}
<ul>
    {% for post in most_commented_posts %}
        <li>
            <a href="{{ post.get_absolute_url }}">{{ post.title }}</a>
        </li>
    {% endfor %}
</ul>
```


å®‰è£…markdown
uv pip install pygments
uv pip install markdown







Fluent Readeråˆ é™¤é”™è¯¯çš„ç½‘å€
%APPDATA%\fluent-reader\ï¼Œåˆ é™¤Databasesç›®å½•ï¼Œé‡å¯





# æ•°æ®è¿ç§»
docker pull postgres:16.2
docker run --name=blog_db -e POSTGRES_DB=blog -e POSTGRES_USER=blog -e POSTGRES_PASSWORD=xxx -p 54321:5432 -d postgres:16.2

ç”¨dockeræ¡Œé¢ç‰ˆç®¡ç†æ›´æ–¹ä¾¿

python -m pip install psycopg==3.1.18
python -m pip install python-decouple  # uv add python-decouple æˆ– python-dotenv

## 1.å¯¼å‡ºæ•°æ®

python -Xutf8 manage.py dumpdata --indent=2 --output=mysite_data.json  #åªæœ‰json,yaml,xmlå‡ ç§æ ¼å¼ï¼Œç¼–ç utf8

## 2.æ›´æ”¹æ•°æ®åº“é…ç½®
DATABASES={
    'default':{
        'ENGINE':'django.db.backends.postgresql',
        'NAME':config('DB_NAME'),
        'USER':config('DB_USER'),
        'PASSWORD':config('DB_PASSWORD'),
        'HOST':config('DB_HOST')
    }
}

## 3.æ›´æ”¹ç¯å¢ƒå˜é‡
DB_NAME=blog
USER=blog
PASSWORD=xxx
HOST=192.168.1.8


## 4.è¿ç§» (åˆ›å»ºäº†è¡¨æ ¼ï¼Œæ²¡æœ‰è½¬å‚¨æ•°æ®)
python manage.py migrate

## 5.è½¬å‚¨æ•°æ®
python manage.py loaddata mysite_data.json


è·å–å¤–ç½‘IP
```python
import requests

def get_public_ip():
    try:
        # ä½¿ç”¨å…è´¹çš„å…¬å…± API
        response = requests.get('https://api.ipify.org', params={'format': 'text'}, timeout=5)
        return response.text.strip()
    except requests.RequestException as e:
        return f"æ— æ³•è·å–IP: {e}"

# è°ƒç”¨å‡½æ•°
public_ip = get_public_ip()
print(f"æœ¬æœºå¤–ç½‘IP: {public_ip}")

#æˆ–
response = requests.get('https://ident.me', timeout=5)
```

å¯ç”¨çš„å…¬å…± APIï¼ˆä»»é€‰å…¶ä¸€ï¼‰ï¼š
https://api.ipify.org ï¼ˆæœ€ç¨³å®šï¼‰
https://ident.me
https://checkip.amazonaws.com
https://icanhazip.com


å¦‚æœéœ€è¦æ¯” python-decouple å’Œ python-dotenv æ›´å¼ºçš„åŠŸèƒ½ï¼ˆå¦‚å¤šç¯å¢ƒã€å±‚çº§é…ç½®ã€YAML æ”¯æŒï¼‰ï¼Œæ¨èä»¥ä¸‹åº“
- dynaconf
- django-environ

**dynaconf**
pip install dynaconf
æ”¯æŒ .envã€settings.tomlã€settings.yaml ç­‰
æä¾› from dynaconf import settings
åŠŸèƒ½éå¸¸å¼ºå¤§ï¼Œé€‚åˆä¸­å¤§å‹é¡¹ç›®

**django-environ**
ä¸“ä¸º Django è®¾è®¡
åº•å±‚ä½¿ç”¨ python-dotenv
pip install django-environ
æ¨èç”¨äº Django é¡¹ç›®

ä½¿ç”¨:
```python
import environ

env = environ.Env()
environ.Env.read_env()

SECRET_KEY = env('SECRET_KEY')
DEBUG = env.bool('DEBUG')
DATABASE_URL = env.db('DATABASE_URL')
```


âœ… æ€»ç»“ï¼šæµè¡Œåº¦æ’å

|åº“å|	æ¨èåœºæ™¯|	æµè¡Œåº¦|
|--|--|--|
|python-dotenv|	âœ… é€šç”¨é¡¹ç›®ã€Flaskã€FastAPI	â­â­â­â­â­ï¼ˆæœ€æµè¡Œï¼‰|
|Django-environ|	âœ… Django é¡¹ç›®	â­â­â­â­â˜†|
|dynaconf|	âœ… å¤æ‚é…ç½®éœ€æ±‚	â­â­â­â˜†|
|python-decouple|	âš ï¸ è€é¡¹ç›®ã€ç®€å•éœ€æ±‚	â­â­â˜†ï¼ˆé€æ¸è¢«æ›¿ä»£ï¼‰|


âœ… æ¨èé€‰æ‹©

|ä½ çš„éœ€æ±‚|	æ¨èåº“|
|--|--|
|æƒ³ç”¨ .env æ–‡ä»¶ç®¡ç†é…ç½®|	âœ… python-dotenvï¼ˆé¦–é€‰ï¼‰|
|Django é¡¹ç›®|	âœ… django-environ|
|éœ€è¦ YAML/TOML é…ç½®|	âœ… dynaconf|
|åªæƒ³è¦ç®€å•ç±»å‹è½¬æ¢|	âš ï¸ python-decoupleï¼ˆå¯ï¼Œä½†éä¸»æµï¼‰|

ğŸ“Œ ç»“è®º
python-dotenv æ˜¯ç›®å‰ Python ä¸­æœ€æµè¡Œã€æœ€å¹¿æ³›ä½¿ç”¨çš„ç¯å¢ƒå˜é‡ç®¡ç†åº“



## æœç´¢
```python
INSTALLED_APPS = [
    'django.contrib.staticfiles',
    'django.contrib.postgres',#å…¨æ–‡æœç´¢pgåŸç”Ÿæ”¯æŒè€Œsqlite3ä¸æ”¯æŒ
    'blog.apps.BlogConfig',
]
```
python manage.py shell
from blog.models import Post
Post.objects.filter(title__search='django')#å•ä¸ªå­—æ®µæœç´¢
#å¤šä¸ªå­—æ®µæœç´¢
from django.contrib.postgres.search import SearchVector
from blog.models import Post
Post.objects.annotate(search=SearchVector('title','body')).filter(search='django')

















































































































































































































































